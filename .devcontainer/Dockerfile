# Development container for MeshMonitor
# Based on Node.js 22 (required for project, Node 18 deprecated)
FROM mcr.microsoft.com/devcontainers/typescript-node:22

# Install additional dependencies
RUN apt-get update && export DEBIAN_FRONTEND=noninteractive \
    && apt-get -y install --no-install-recommends \
        git \
        python3 \
        python3-pip \
        python3-venv \
        sqlite3 \
    && pip3 install --break-system-packages apprise \
    && apt-get clean -y && rm -rf /var/lib/apt/lists/*


# Set up workspace
WORKDIR /workspace

# Create .vscode-server directory structure with correct ownership
# When Docker mounts an empty volume on this directory, it copies the structure with permissions
RUN mkdir -p /home/node/.vscode-server/bin \
             /home/node/.vscode-server/data/Machine \
             /home/node/.vscode-server/extensions \
             /home/node/.vscode-server-insiders/bin \
             /home/node/.vscode-server-insiders/data/Machine \
             /home/node/.vscode-server-insiders/extensions \
    && chown -R node:node /home/node/.vscode-server /home/node/.vscode-server-insiders

# Use non-root user for security
USER node

# Default shell
ENV SHELL=/bin/bash
